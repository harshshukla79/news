<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Loading Article...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <meta name="description" content="Full report and authoritative analysis from The Global Chronicle.">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; }
        .masthead-bg { background-color: #0d47a1; color: white; } /* Deep Blue for Authority */
        .article-body-font { font-size: 1.125rem; line-height: 1.8; } /* 18px body text for 45+ audience readability */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #0d47a1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-900">
    <!-- Header/Masthead - Kept Intact from Homepage -->
    <header class="masthead-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col lg:flex-row justify-between items-center">
                <h1 class="text-5xl font-extrabold tracking-tight">
                    <a href="index.html" class="hover:text-gray-200 transition duration-150">The Global Chronicle</a>
                </h1>
                <nav class="mt-4 lg:mt-0 space-x-6 text-xl font-medium">
                    <a href="index.html" class="hover:text-red-300 border-b-2 border-transparent transition duration-150 pb-1">Home</a>
                    <a href="daily_news.html" class="hover:text-red-300 border-b-2 border-transparent transition duration-150 pb-1">Daily News</a>
                    <a href="privacy.html" class="hover:text-red-300 transition duration-150 pb-1">Privacy</a>
                    <a href="terms.html" class="hover:text-red-300 transition duration-150 pb-1">Terms</a>
                    <a href="contact.html" class="hover:text-red-300 transition duration-150 pb-1">Contact</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-10">
        <div class="grid lg:grid-cols-4 gap-10">
            <!-- Left Column: Article Content (Lg: col-span-3) -->
            <div class="lg:col-span-3 bg-white p-8 rounded-xl shadow-2xl">
                
                <!-- Article Header & Meta -->
                <p id="article-category" class="text-xl text-red-600 font-semibold mb-2 uppercase">Category</p>
                <h2 id="article-headline" class="text-5xl font-extrabold mb-4 leading-tight">
                    Loading Headline...
                </h2>
                <p class="text-lg text-gray-500 mb-6 border-b pb-4">
                    By **The Global Chronicle Staff** | <span id="article-date">October 30, 2025</span>
                </p>

                <!-- Image & Ad Slot 1 (Premium Placement) -->
                <div id="image-ad-container" class="mb-8 space-y-6">
                    <!-- Image Placeholder/Container -->
                    <div id="article-image-container" class="w-full h-auto bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden min-h-64">
                         <div class="loading-spinner w-10 h-10"></div>
                    </div>
                    
                    <!-- AD SLOT 1: Large Leaderboard/Display Ad (High Revenue) -->
                    <div class="bg-yellow-100 text-center py-6 rounded-lg border-2 border-yellow-500 shadow-md">
                        <p class="text-sm uppercase text-gray-700 font-semibold mb-1">Advertisement: Premium Placement</p>
                        <p class="text-2xl font-bold text-gray-800">GOOGLE DISPLAY AD UNIT: 970x250 or 728x90</p>
                        <p class="text-sm text-gray-600">The first key ad slot, designed for maximum visibility on desktop.</p>
                    </div>
                </div>

                <!-- Article Body (Dynamic Content) -->
                <div id="article-body" class="article-body-font space-y-6 text-gray-800">
                    <p>Fetching full article content...</p>
                </div>
                
                <!-- Citations/Attribution Placeholder -->
                <div id="article-citations" class="mt-10 pt-4 border-t border-gray-200 text-sm text-gray-500 italic">
                    <p>Source materials and citations are provided by the Google Search grounding mechanism used to generate this report. Full details on our methodology can be found in our Terms of Service.</p>
                </div>
            </div>

            <!-- Right Column: Sidebar (Ad Slot 2 & Categories) -->
            <aside class="lg:col-span-1 space-y-8">
                
                <!-- AD SLOT 2: Skyscraper Ad (Persistent Revenue) -->
                <div class="bg-yellow-100 text-center py-24 rounded-xl border-2 border-yellow-500 shadow-lg h-96 flex flex-col justify-center">
                    <p class="text-sm uppercase text-gray-700 font-semibold mb-1">Advertisement</p>
                    <p class="text-2xl font-bold text-gray-800">GOOGLE DISPLAY AD UNIT: 300x600 Skyscraper</p>
                    <p class="text-sm text-gray-600">The main sidebar ad for continuous high-value impression tracking.</p>
                </div>

                <!-- Trending Content -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-600">
                    <h3 class="text-2xl font-bold mb-4 border-b pb-2">Trending Now</h3>
                    <ul class="space-y-3 text-lg">
                        <li><a href="daily_news.html" class="hover:text-red-600 transition duration-150 font-medium">How to Optimize Your 401(k) Post-55</a></li>
                        <li><a href="daily_news.html" class="hover:text-red-600 transition duration-150 font-medium">The Truth About Long-Term Care Insurance</a></li>
                        <li><a href="daily_news.html" class="hover:text-red-600 transition duration-150 font-medium">Global Conflict Shifts: An In-Depth Map</a></li>
                    </ul>
                </div>
            </aside>
        </div>
    </main>

    <!-- Footer - Kept Intact from Homepage -->
    <footer class="masthead-bg mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-white text-center">
            <p class="text-xl font-bold mb-4">The Global Chronicle â€” Reliable. Unbiased. Authoritative.</p>
            <div class="flex justify-center space-x-6 text-lg font-medium">
                <a href="privacy.html" class="hover:text-red-300 transition duration-150">Privacy Policy</a>
                <span class="text-red-400">|</span>
                <a href="terms.html" class="hover:text-red-300 transition duration-150">Terms & Conditions</a>
                <span class="text-red-400">|</span>
                <a href="contact.html" class="hover:text-red-300 transition duration-150">Contact Us</a>
                <span class="text-red-400">|</span>
                <a href="daily_news.html" class="hover:text-red-300 transition duration-150">Archives</a>
            </div>
            <p class="mt-4 text-sm text-gray-300">&copy; 2025 The Global Chronicle. All rights reserved. Content provided for informational purposes only.</p>
        </div>
    </footer>

    <script>
        // --- API & UTIL FUNCTIONS ---
        const API_KEY = "";
        const TEXT_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        const IMAGE_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${API_KEY}`;
        const MAX_RETRIES = 5;

        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const regex = /([^&=]+)=([^&]*)/g;
            let m;
            while (m = regex.exec(queryString)) {
                params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
            }
            return params;
        }

        async function fetchWithRetry(url, payload, retries = 0) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (response.status === 429 && retries < MAX_RETRIES) {
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithRetry(url, payload, retries + 1);
                    }
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                return response.json();

            } catch (error) {
                console.error("Error during API fetch:", error);
                throw error;
            }
        }

        async function generateArticleImage(headline) {
            const imagePrompt = `A high-quality, professional, photojournalistic image illustrating a key concept from the news headline: "${headline}". The style should be authoritative and trustworthy, suitable for a major US newspaper. Aspect ratio 16:9.`;
            
            const payload = { 
                instances: { prompt: imagePrompt }, 
                parameters: { "sampleCount": 1, "aspectRatio": "16:9" } 
            };
            
            try {
                const result = await fetchWithRetry(IMAGE_API_URL, payload);
                const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
                
                if (base64Data) {
                    return `data:image/png;base64,${base64Data}`;
                }
            } catch (error) {
                console.warn(`Could not generate image for headline: ${headline}`);
                return null;
            }
            return null;
        }

        // --- MAIN PAGE LOGIC ---
        async function loadArticleContent() {
            const params = getUrlParams();
            const headline = params.headline || "Failed to load specific article.";
            const category = params.category || "Unknown";

            // Update static elements
            document.getElementById('page-title').textContent = headline;
            document.getElementById('article-headline').textContent = headline;
            document.getElementById('article-category').textContent = category;
            
            const imageContainer = document.getElementById('article-image-container');
            const articleBody = document.getElementById('article-body');

            // 1. Generate Image
            const imageUrl = await generateArticleImage(headline);
            if (imageUrl) {
                imageContainer.innerHTML = `<img src="${imageUrl}" alt="${headline}" class="w-full h-auto object-cover rounded-lg shadow-lg">`;
            } else {
                imageContainer.innerHTML = `<p class="text-lg text-gray-500">Image failed to generate. Continuing with text content...</p>`;
            }

            // 2. Generate Full Article Text
            const systemPrompt = `You are a world-class investigative journalist for "The Global Chronicle." Write a detailed, in-depth, multi-paragraph news article based on the following headline and category. The tone must be authoritative, neutral, and highly informative, specifically addressing the financial, political, or health impacts relevant to an educated American audience aged 45 and over. Use clear section headings (e.g., 'The Current Situation,' 'Expert Analysis') and write at least 500 words. Format the content using only HTML paragraphs (<p>) and strong tags (<strong>) for headings, ensuring clear readability.`;
            const userQuery = `Write a comprehensive report for the category: ${category} with the headline: ${headline}`;

            try {
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };
                
                const result = await fetchWithRetry(TEXT_API_URL, payload);
                let text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: Could not retrieve article content.";

                // Simple cleanup and formatting conversion if necessary
                text = text.replace(/\n\s*\n/g, '</p><p>');
                text = `<p class="article-body-font text-gray-800"><strong>INTRODUCTION:</strong> ${text}</p>`;

                articleBody.innerHTML = text;

            } catch (error) {
                console.error("Failed to fetch full article:", error);
                articleBody.innerHTML = '<p class="text-red-600 font-bold">ERROR: Failed to load detailed article content. Please check connection or try refreshing.</p>';
            }
        }

        window.onload = loadArticleContent;
    </script>
</body>
</html>
